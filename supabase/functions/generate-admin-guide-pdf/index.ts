import { serve } from "https://deno.land/std@0.168.0/http/server.ts";

const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Headers": "authorization, x-client-info, apikey, content-type",
};

serve(async (req) => {
  if (req.method === "OPTIONS") {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    // Embedded markdown content to avoid file access issues
    const markdown = `# üìò Guide d'Onboarding Administrateur - Regen School

> **Version D√©butant - Pas √† Pas**  
> Ce guide est con√ßu pour vous accompagner dans vos premiers pas en tant qu'administrateur de la plateforme Regen School, m√™me si vous n'avez jamais utilis√© ce type d'outil auparavant.

---

## Table des Mati√®res

1. [Premi√®re Connexion](#premi√®re-connexion)
2. [Comprendre l'Interface](#comprendre-linterface)
3. [Gestion des Utilisateurs](#gestion-des-utilisateurs)
4. [Configuration de l'Ann√©e Scolaire](#configuration-de-lann√©e-scolaire)
5. [Gestion des Classes et Niveaux](#gestion-des-classes-et-niveaux)
6. [Gestion des Mati√®res](#gestion-des-mati√®res)
7. [Gestion des √âtudiants](#gestion-des-√©tudiants)
8. [Consultation des Notes](#consultation-des-notes)
9. [Gestion des Documents](#gestion-des-documents)
10. [Journal d'Audit](#journal-daudit)
11. [Bonnes Pratiques](#bonnes-pratiques)
12. [Support et Aide](#support-et-aide)
13. [R√©capitulatif du Workflow Recommand√©](#r√©capitulatif-du-workflow-recommand√©)

---

## Premi√®re Connexion

### √âtape 1 : R√©ception de l'Invitation

Vous recevrez un **email d'invitation** contenant un lien pour cr√©er votre compte administrateur.

**Exemple d'email :**
\`\`\`
Objet : Invitation √† rejoindre Regen School
Bonjour,

Vous avez √©t√© invit√©(e) √† rejoindre Regen School en tant qu'administrateur.
Cliquez sur le lien ci-dessous pour cr√©er votre compte :
[Cr√©er mon compte]

Ce lien est valable pendant 7 jours.
\`\`\`

### √âtape 2 : Cr√©ation de votre compte

1. Cliquez sur le lien dans l'email
2. Vous arriverez sur une page de cr√©ation de compte
3. Entrez votre **mot de passe** (minimum 8 caract√®res)
4. Confirmez votre mot de passe
5. Cliquez sur **"Cr√©er mon compte"**

> **üí° Conseil :** Utilisez un mot de passe fort combinant majuscules, minuscules, chiffres et caract√®res sp√©ciaux.

### √âtape 3 : Premi√®re connexion

Une fois votre compte cr√©√©, vous serez automatiquement connect√©(e) et dirig√©(e) vers le **tableau de bord**.

> **‚ÑπÔ∏è Important :** En tant qu'administrateur, vous avez aussi automatiquement le r√¥le "enseignant". Vous pouvez donc cr√©er des mati√®res et saisir des notes si besoin.

---

## Comprendre l'Interface

### Navigation Principale

L'interface est organis√©e en plusieurs sections accessibles depuis le menu principal :

- **Tableau de bord** : Vue d'ensemble de l'activit√©
- **Annuaire** : Liste de tous les √©tudiants
- **Notes** : Consultation et saisie des notes
- **Mati√®res** : Gestion des mati√®res enseign√©es
- **Param√®tres** : Configuration du syst√®me (r√©serv√© aux administrateurs)
- **Audit** : Journal de toutes les actions importantes
- **Profil** : Vos informations personnelles

### Bascule de R√¥le

En haut √† droite de l'interface, vous pouvez basculer entre vos r√¥les :
- **Mode Administrateur** : Acc√®s complet √† tous les param√®tres
- **Mode Enseignant** : Vue et fonctionnalit√©s d'un enseignant

> **üí° Astuce :** Utilisez le mode enseignant pour tester l'exp√©rience de vos coll√®gues.

---

## Gestion des Utilisateurs

### Inviter un Nouvel Utilisateur

**Chemin :** Param√®tres ‚Üí Utilisateurs ‚Üí "Inviter un utilisateur"

1. Cliquez sur le bouton **"Inviter un utilisateur"**
2. Remplissez le formulaire :
   - **Email** : L'adresse email de la personne
   - **Nom complet** : Son nom et pr√©nom
   - **R√¥le** : Admin ou Enseignant
   - **Mati√®re(s)** : (Uniquement pour les enseignants) S√©lectionnez les mati√®res qu'il/elle enseignera
3. Cliquez sur **"Envoyer l'invitation"**

**Que se passe-t-il ensuite ?**
- La personne re√ßoit un email d'invitation
- Elle a 7 jours pour cr√©er son compte
- Une fois son compte cr√©√©, elle appara√Æt dans la liste des utilisateurs

### Renvoyer une Invitation

Si un utilisateur n'a pas re√ßu ou a perdu son email d'invitation :

1. Allez dans **Param√®tres ‚Üí Utilisateurs**
2. Trouvez l'utilisateur dans la liste
3. Cliquez sur le bouton **"Renvoyer l'invitation"**

### R√©initialiser un Mot de Passe

Si un utilisateur a oubli√© son mot de passe :

1. Allez dans **Param√®tres ‚Üí Utilisateurs**
2. Trouvez l'utilisateur dans la liste
3. Cliquez sur **"R√©initialiser le mot de passe"**
4. L'utilisateur recevra un email avec un lien pour d√©finir un nouveau mot de passe

### Modifier les Informations d'un Enseignant

Pour modifier les mati√®res assign√©es √† un enseignant :

1. Allez dans **Param√®tres ‚Üí Enseignants**
2. Trouvez l'enseignant dans la liste
3. Cliquez sur l'ic√¥ne **crayon** (√©dition)
4. Modifiez les informations n√©cessaires
5. Cliquez sur **"Mettre √† jour"**

### Supprimer un Utilisateur

> **‚ö†Ô∏è Attention :** La suppression est d√©finitive et supprime √©galement toutes les donn√©es associ√©es (notes saisies, etc.)

1. Allez dans **Param√®tres ‚Üí Utilisateurs**
2. Trouvez l'utilisateur dans la liste
3. Cliquez sur l'ic√¥ne **poubelle**
4. Confirmez la suppression

---

## Configuration de l'Ann√©e Scolaire

### Cr√©er une Nouvelle Ann√©e Scolaire

**Chemin :** Param√®tres ‚Üí Ann√©es Scolaires ‚Üí "Nouvelle ann√©e scolaire"

1. Cliquez sur **"Nouvelle ann√©e scolaire"**
2. Remplissez les informations :
   - **Nom** : Ex. "2024-2025"
   - **Date de d√©but** : Premier jour de l'ann√©e scolaire
   - **Date de fin** : Dernier jour de l'ann√©e scolaire
   - **Est active** : Cochez si c'est l'ann√©e en cours
3. Cliquez sur **"Cr√©er"**

> **üí° Important :** Une seule ann√©e scolaire peut √™tre "active" √† la fois.

### Cr√©er des P√©riodes Acad√©miques (Trimestres/Semestres)

Une fois l'ann√©e scolaire cr√©√©e, vous devez d√©finir les p√©riodes :

**Chemin :** Param√®tres ‚Üí Ann√©es Scolaires ‚Üí [Votre ann√©e] ‚Üí "Nouvelle p√©riode"

1. S√©lectionnez votre ann√©e scolaire dans la liste
2. Cliquez sur **"Nouvelle p√©riode"**
3. Remplissez :
   - **Nom** : Ex. "Trimestre 1" ou "Semestre 1"
   - **Date de d√©but** : Premier jour de la p√©riode
   - **Date de fin** : Dernier jour de la p√©riode
4. Cliquez sur **"Cr√©er"**

**Exemple de configuration :**
\`\`\`
Ann√©e 2024-2025
‚îú‚îÄ‚îÄ Trimestre 1 : 01/09/2024 - 20/12/2024
‚îú‚îÄ‚îÄ Trimestre 2 : 06/01/2025 - 04/04/2025
‚îî‚îÄ‚îÄ Trimestre 3 : 21/04/2025 - 04/07/2025
\`\`\`

---

## Gestion des Classes et Niveaux

### Cr√©er un Niveau Acad√©mique

**Chemin :** Param√®tres ‚Üí Niveaux ‚Üí "Nouveau niveau"

Les niveaux repr√©sentent les ann√©es d'√©tudes (ex: Licence 1, Master 2, etc.)

1. Cliquez sur **"Nouveau niveau"**
2. Entrez le **nom du niveau** : Ex. "Licence 1"
3. Cliquez sur **"Cr√©er"**

### Cr√©er une Classe

**Chemin :** Param√®tres ‚Üí Classes ‚Üí "Nouvelle classe"

Les classes sont des groupes d'√©tudiants au sein d'un niveau.

1. Cliquez sur **"Nouvelle classe"**
2. Remplissez :
   - **Nom** : Ex. "L1-A" ou "L1-Groupe A"
   - **Niveau** : S√©lectionnez le niveau associ√©
   - **Ann√©e scolaire** : S√©lectionnez l'ann√©e concern√©e
3. Cliquez sur **"Cr√©er"**

**Exemple de structure :**
\`\`\`
Licence 1
‚îú‚îÄ‚îÄ L1-A (30 √©tudiants)
‚îú‚îÄ‚îÄ L1-B (28 √©tudiants)
‚îî‚îÄ‚îÄ L1-C (32 √©tudiants)
\`\`\`

---

## Gestion des Mati√®res

### Acc√©der √† la Gestion des Mati√®res

**Chemin :** Param√®tres ‚Üí Mati√®res

Ici vous pouvez voir toutes les mati√®res cr√©√©es par les enseignants.

> **‚ÑπÔ∏è Note :** Seuls les enseignants peuvent cr√©er de nouvelles mati√®res. En tant qu'admin, vous pouvez les visualiser et les g√©rer, mais la cr√©ation se fait depuis le r√¥le enseignant.

### Cr√©er une Mati√®re (en tant qu'enseignant)

Si vous devez cr√©er une mati√®re :

1. Basculez en **mode enseignant** (s√©lecteur en haut √† droite)
2. Allez dans **Mati√®res**
3. Cliquez sur **"Nouvelle mati√®re"**
4. Remplissez les informations et cr√©ez

---

## Gestion des √âtudiants

### Ajouter un √âtudiant Manuellement

**Chemin :** Annuaire ‚Üí "Ajouter un √©tudiant"

1. Cliquez sur **"Ajouter un √©tudiant"**
2. Remplissez le formulaire :
   - **Nom** et **Pr√©nom**
   - **Email** (optionnel mais recommand√©)
   - **Date de naissance**
   - **Niveau** : S√©lectionnez le niveau
   - **Classe** : S√©lectionnez la classe
   - **Statut** : Actif par d√©faut
3. Cliquez sur **"Ajouter"**

### Importer des √âtudiants en Masse

Pour gagner du temps, vous pouvez importer plusieurs √©tudiants via un fichier CSV.

**Chemin :** Annuaire ‚Üí "Importer des √©tudiants"

1. Cliquez sur **"Importer des √©tudiants"**
2. T√©l√©chargez le **mod√®le CSV** fourni
3. Remplissez le fichier CSV avec vos donn√©es :
   - Respectez l'ordre des colonnes
   - Format des dates : JJ/MM/AAAA
   - V√©rifiez qu'il n'y a pas de lignes vides
4. Importez le fichier
5. V√©rifiez les donn√©es dans l'aper√ßu
6. Cliquez sur **"Confirmer l'import"**

**Format du CSV :**
\`\`\`csv
nom,prenom,email,date_naissance,niveau,classe
Dupont,Jean,jean.dupont@example.com,15/03/2004,Licence 1,L1-A
Martin,Marie,marie.martin@example.com,22/07/2004,Licence 1,L1-A
\`\`\`

### Modifier un √âtudiant

1. Dans **Annuaire**, trouvez l'√©tudiant
2. Cliquez sur sa fiche
3. Cliquez sur **"Modifier"**
4. Effectuez vos modifications
5. Cliquez sur **"Enregistrer"**

### Ajouter une Photo √† un √âtudiant

1. Ouvrez la fiche de l'√©tudiant
2. Cliquez sur l'avatar (image de profil)
3. S√©lectionnez une image depuis votre ordinateur
4. La photo est automatiquement enregistr√©e

---

## Consultation des Notes

### Acc√©der aux Notes

**Chemin :** Notes

Dans cette section, vous pouvez consulter toutes les notes saisies par les enseignants.

### Filtrer les Notes

Utilisez les filtres en haut de la page pour affiner votre recherche :
- **Ann√©e scolaire**
- **P√©riode acad√©mique**
- **Niveau**
- **Classe**
- **Mati√®re**

### Exporter les Notes

1. Appliquez vos filtres si n√©cessaire
2. Cliquez sur **"Exporter en CSV"**
3. Le fichier sera t√©l√©charg√© automatiquement

### Statistiques Automatiques

Le syst√®me affiche automatiquement :
- Moyenne de la classe
- Nombre d'√©tudiants
- Note minimale et maximale
- Distribution des notes

---

## Gestion des Documents

Les enseignants peuvent d√©poser des documents (cours, TD, supports p√©dagogiques).

**Chemin :** Param√®tres ‚Üí Documents

### Consulter les Documents

Vous pouvez voir tous les documents d√©pos√©s par les enseignants, organis√©s par :
- Cat√©gorie
- Enseignant
- Date de d√©p√¥t

### Approuver ou Rejeter un Document

Si la validation est activ√©e dans votre √©tablissement :

1. Allez dans **Param√®tres ‚Üí Documents**
2. Trouvez le document en attente
3. Cliquez sur :
   - **"Approuver"** pour valider le document
   - **"Rejeter"** pour refuser (ajoutez un commentaire expliquant pourquoi)

---

## Journal d'Audit

Le journal d'audit enregistre toutes les actions sensibles effectu√©es sur la plateforme.

**Chemin :** Audit

### Que trouve-t-on dans le journal d'audit ?

- Cr√©ation/modification/suppression d'utilisateurs
- Cr√©ation/modification/suppression d'√©tudiants
- Saisie et modification de notes
- Imports de donn√©es
- Changements de configuration

### Filtrer les Logs

Vous pouvez filtrer par :
- **Utilisateur** : Qui a effectu√© l'action
- **Type d'action** : Cr√©ation, modification, suppression
- **Table affect√©e** : √âtudiants, notes, utilisateurs, etc.
- **Date** : P√©riode sp√©cifique

### D√©tails d'un Log

Chaque entr√©e du journal contient :
- **Date et heure** pr√©cise
- **Utilisateur** qui a effectu√© l'action
- **Type d'action**
- **D√©tails** de ce qui a √©t√© modifi√©
- **Anciennes et nouvelles valeurs** (pour les modifications)

**Exemple de log :**
\`\`\`
üìÖ 17/10/2025 14:32:15
üë§ Marie Dupont
‚úèÔ∏è Modification
üìä Table : students
üîç D√©tails : Changement de classe
   Ancien : L1-A
   Nouveau : L1-B
   √âtudiant : Jean Martin
\`\`\`

---

## Bonnes Pratiques

### S√©curit√©

1. **Mots de passe** : Encouragez l'utilisation de mots de passe forts
2. **R√©vision r√©guli√®re** : V√©rifiez p√©riodiquement la liste des utilisateurs actifs
3. **R√¥les appropri√©s** : N'accordez le r√¥le admin qu'aux personnes qui en ont vraiment besoin
4. **Consultation des logs** : Consultez r√©guli√®rement le journal d'audit

### Organisation

1. **Structure claire** : 
   - Cr√©ez la structure (ann√©es ‚Üí p√©riodes ‚Üí niveaux ‚Üí classes) AVANT d'ajouter les √©tudiants
   - Utilisez des noms de classes coh√©rents (ex: L1-A, L1-B au lieu de "Groupe 1", "Groupe 2")

2. **Conventions de nommage** :
   - Ann√©es scolaires : "2024-2025"
   - P√©riodes : "Trimestre 1", "Semestre 1"
   - Classes : "L1-A", "M2-INFO-B"

### Gestion des Utilisateurs

1. **Invitations** : Envoyez les invitations au moins une semaine avant le d√©but de l'ann√©e
2. **Suivi** : V√©rifiez que tous les invit√©s ont cr√©√© leur compte
3. **Communication** : Pr√©venez les enseignants de v√©rifier leurs spams

### Gestion des Donn√©es √âtudiantes

1. **Imports CSV** :
   - Testez d'abord avec un petit fichier (5-10 √©tudiants)
   - V√©rifiez l'aper√ßu avant de confirmer
   - Gardez une copie de sauvegarde de vos fichiers CSV

2. **V√©rification** :
   - Apr√®s un import, v√©rifiez quelques fiches al√©atoirement
   - Assurez-vous que les classes et niveaux sont corrects

### Sauvegardes et Exports

1. Exportez r√©guli√®rement les donn√©es importantes (√©tudiants, notes)
2. Conservez ces exports dans un endroit s√ªr
3. Effectuez un export complet en fin de chaque p√©riode acad√©mique

---

## Support et Aide

### En Cas de Probl√®me

1. **Consultez d'abord ce guide** : La solution est peut-√™tre ici
2. **V√©rifiez les logs** : Le journal d'audit peut vous aider √† comprendre ce qui s'est pass√©
3. **Contactez le support** : Si le probl√®me persiste

### Ressources Disponibles

- **Guide utilisateur** : Ce document
- **FAQ** : Questions fr√©quemment pos√©es (accessible depuis le menu d'aide)
- **Tutoriels vid√©o** : Disponibles dans la section Aide
- **Support technique** : support@regen-school.com

---

## R√©capitulatif du Workflow Recommand√©

### Au D√©but de l'Ann√©e Scolaire

\`\`\`
1. Cr√©er l'ann√©e scolaire
   ‚Üì
2. Cr√©er les p√©riodes acad√©miques (trimestres/semestres)
   ‚Üì
3. Cr√©er/v√©rifier les niveaux acad√©miques
   ‚Üì
4. Cr√©er les classes pour chaque niveau
   ‚Üì
5. Inviter les enseignants
   ‚Üì
6. Attendre que les enseignants cr√©ent leurs mati√®res
   ‚Üì
7. Importer ou ajouter les √©tudiants
   ‚Üì
8. V√©rifier que tout est en place
   ‚Üì
9. Formation rapide des enseignants
   ‚Üì
10. D√©but de l'ann√©e ! üéâ
\`\`\`

### Pendant l'Ann√©e

- Consultation r√©guli√®re du journal d'audit
- V√©rification des notes saisies
- Ajout de nouveaux √©tudiants si n√©cessaire
- Gestion des demandes des enseignants

### Fin d'Ann√©e

- Export complet des notes
- Export de la liste des √©tudiants
- Pr√©paration de l'ann√©e suivante
- Archivage des donn√©es

---

**F√©licitations !** üéä  
Vous √™tes maintenant pr√™t(e) √† administrer efficacement la plateforme Regen School.

N'h√©sitez pas √† explorer l'interface, tester les fonctionnalit√©s en environnement de test, et √† consulter ce guide aussi souvent que n√©cessaire.

**Bonne administration !** üìö‚ú®`;

    // Convert markdown to styled HTML
    const html = generateStyledHTML(markdown);

    // Return HTML that can be printed as PDF
    return new Response(html, {
      headers: {
        ...corsHeaders,
        "Content-Type": "text/html; charset=utf-8",
      },
    });

  } catch (error) {
    console.error("Error generating guide:", error);
    const errorMessage = error instanceof Error ? error.message : "Unknown error";
    return new Response(
      JSON.stringify({ error: errorMessage }),
      {
        status: 500,
        headers: { ...corsHeaders, "Content-Type": "application/json" },
      }
    );
  }
});

function generateStyledHTML(markdown: string): string {
  // Convert markdown to HTML with enhanced styling
  let html = markdown;

  // Escape HTML special characters in code blocks first
  html = html.replace(/```([\s\S]*?)```/g, (match, code) => {
    return '<pre><code>' + escapeHtml(code.trim()) + '</code></pre>';
  });

  // Headers
  html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
  html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
  html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');

  // Bold
  html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

  // Italic
  html = html.replace(/(?<!\*)\*(?!\*)([^*]+)(?<!\*)\*(?!\*)/g, '<em>$1</em>');

  // Inline code
  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

  // Blockquotes
  html = html.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');

  // Unordered lists
  html = html.replace(/^\* (.*$)/gim, '<li>$1</li>');
  html = html.replace(/^- (.*$)/gim, '<li>$1</li>');

  // Numbered lists
  html = html.replace(/^\d+\. (.*$)/gim, '<li>$1</li>');

  // Wrap consecutive <li> in <ul>
  html = html.replace(/(<li>.*?<\/li>\s*)+/gs, (match) => {
    return '<ul>' + match + '</ul>';
  });

  // Links
  html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');

  // Horizontal rules
  html = html.replace(/^---$/gim, '<hr>');

  // Paragraphs
  html = html.split('\n\n').map(para => {
    if (!para.trim()) return '';
    if (para.startsWith('<h') || para.startsWith('<ul') || 
        para.startsWith('<pre') || para.startsWith('<hr') ||
        para.startsWith('<blockquote')) {
      return para;
    }
    return '<p>' + para + '</p>';
  }).join('\n');

  return `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guide Administrateur - Regen School</title>
  <style>
    @page {
      size: A4;
      margin: 2.5cm;
    }
    
    @media print {
      body { margin: 0; }
      .page-break { page-break-before: always; }
      h1, h2, h3 { page-break-after: avoid; }
      pre, blockquote { page-break-inside: avoid; }
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.8;
      color: #1a202c;
      max-width: 21cm;
      margin: 0 auto;
      padding: 20px;
      background: #ffffff;
    }
    
    h1 {
      color: #2563eb;
      font-size: 2.5em;
      border-bottom: 4px solid #2563eb;
      padding-bottom: 15px;
      margin-top: 40px;
      margin-bottom: 20px;
    }
    
    h2 {
      color: #1e40af;
      font-size: 2em;
      margin-top: 35px;
      margin-bottom: 15px;
      border-left: 6px solid #3b82f6;
      padding-left: 15px;
    }
    
    h3 {
      color: #3b82f6;
      font-size: 1.5em;
      margin-top: 25px;
      margin-bottom: 12px;
    }
    
    p {
      margin: 12px 0;
      text-align: justify;
    }
    
    pre {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-left: 6px solid #3b82f6;
      padding: 20px;
      overflow-x: auto;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      line-height: 1.6;
      margin: 20px 0;
    }
    
    code {
      background: #e5e7eb;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #dc2626;
    }
    
    pre code {
      background: transparent;
      padding: 0;
      color: #1e293b;
    }
    
    blockquote {
      background: #fef3c7;
      border-left: 6px solid #f59e0b;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      font-style: italic;
    }
    
    ul, ol {
      margin: 15px 0;
      padding-left: 40px;
    }
    
    li {
      margin: 8px 0;
      line-height: 1.6;
    }
    
    a {
      color: #2563eb;
      text-decoration: none;
      border-bottom: 1px solid #93c5fd;
    }
    
    a:hover {
      border-bottom-color: #2563eb;
    }
    
    hr {
      border: none;
      border-top: 2px solid #e5e7eb;
      margin: 40px 0;
    }
    
    strong {
      color: #1e40af;
      font-weight: 600;
    }
    
    .cover {
      text-align: center;
      padding: 150px 0;
      page-break-after: always;
    }
    
    .cover h1 {
      font-size: 4em;
      border: none;
      margin-bottom: 30px;
      color: #1e40af;
    }
    
    .cover p {
      font-size: 1.8em;
      color: #64748b;
      margin: 20px 0;
    }
    
    .cover .subtitle {
      font-size: 1.4em;
      color: #475569;
      margin-top: 60px;
      font-weight: 500;
    }
    
    .cover .date {
      font-size: 1.1em;
      color: #94a3b8;
      margin-top: 80px;
    }
    
    @media screen {
      body {
        background: #f1f5f9;
        padding: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="cover">
    <h1>üìò Guide Administrateur</h1>
    <p>Regen School</p>
    <p class="subtitle">Version D√©butant - Pas √† Pas</p>
    <p class="date">${new Date().toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
  </div>
  
  <div class="content">
    ${html}
  </div>
  
  <script>
    // Auto-print on load if requested
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('autoprint') === 'true') {
      window.onload = () => {
        setTimeout(() => window.print(), 500);
      };
    }
  </script>
</body>
</html>`;
}

function escapeHtml(text: string): string {
  const map: { [key: string]: string } = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}
